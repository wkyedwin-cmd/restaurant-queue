<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Queue System</title>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAhha-pRzGBXHfSO3PdZ0UmLgGtxfLWcPQ",
  authDomain: "yunnans-1u.firebaseapp.com",
  projectId: "yunnans-1u",
  storageBucket: "yunnans-1u.firebasestorage.app",
  messagingSenderId: "490439485047",
  appId: "1:490439485047:web:42d5ca722ade09c6b88872"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

function today(){
  return new Date().toISOString().split("T")[0];
}

function currentTime(){
  return new Date().toLocaleTimeString();
}

async function joinQueue(){

  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const adults = document.getElementById("adults").value;
  const babyChairs = document.getElementById("babyChairs").value;
  const seat = document.querySelector('input[name="seat"]:checked');

  if(!name || !phone || !adults || !seat){
    alert("è¯·å¡«å†™å®Œæ•´èµ„æ–™");
    return;
  }

  if(phone.startsWith("0")){
    alert("ç”µè¯å·ç ä¸è¦ä»¥ 0 å¼€å¤´");
    return;
  }

  const snapshot = await db.collection("queues")
    .where("date","==",today())
    .get();

  const queueNumber = "Q" + String(snapshot.size+1).padStart(3,"0");

  db.collection("queues").add({
    queueNumber: queueNumber,
    name: name,
    phone: phone,
    adults: parseInt(adults),
    babyChairs: parseInt(babyChairs) || 0,
    seatPreference: seat.value,
    status: "waiting",
    date: today(),
    time: currentTime(),
    timestamp: Date.now()
  });

  alert("æäº¤æˆåŠŸï¼æ‚¨çš„å·ç æ˜¯ " + queueNumber);
}
</script>

</head>

<body>

<h2>ğŸœ æ’é˜Ÿç³»ç»Ÿ</h2>

å§“å:<br>
<input id="name"><br><br>

ç”µè¯:<br>
<input id="phone"><br><br>

æˆäººæ•°é‡:<br>
<input type="number" id="adults"><br><br>

å®å®æ¤…æ•°é‡:<br>
<input type="number" id="babyChairs" value="0"><br><br>

<h3>åº§ä½é€‰æ‹©</h3>

<input type="radio" name="seat" value="å®¤å†… Indoor"> å®¤å†…<br>
<input type="radio" name="seat" value="å®¤å¤– Outdoor"> å®¤å¤–<br>
<input type="radio" name="seat" value="éšæ„æœ€å¿« No Preference"> éšæ„æœ€å¿«<br><br>

<button onclick="joinQueue()">æäº¤</button>

</body>
</html>
