function getDailyLetter() {
  const today = new Date();
  const start = new Date(today.getFullYear(), 0, 0);
  const diff = today - start;
  const dayOfYear = Math.floor(diff / (1000 * 60 * 60 * 24));

  const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  return letters[dayOfYear % 26];
}

async function generateDailyQueueNumber() {
  const today = new Date().toISOString().split("T")[0];
  const dailyLetter = getDailyLetter();

  while (true) {
    const randomNumber = Math.floor(Math.random() * 999) + 1;
    const formattedNumber = String(randomNumber).padStart(3, "0");

    const fullQueueNumber = dailyLetter + formattedNumber;

    const q = query(
      collection(db, "queues"),
      where("date", "==", today),
      where("queueNumber", "==", fullQueueNumber)
    );

    const snapshot = await getDocs(q);

    if (snapshot.empty) {
      return fullQueueNumber;
    }
  }
}
