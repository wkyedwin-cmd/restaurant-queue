<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Queue System</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, query, where } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAhha-pRzGBXHfSO3PdZ0UmLgGtxfLWcPQ",
  authDomain: "yunnans-1u.firebaseapp.com",
  projectId: "yunnans-1u",
  storageBucket: "yunnans-1u.firebasestorage.app",
  messagingSenderId: "490439485047",
  appId: "1:490439485047:web:42d5ca722ade09c6b88872"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

function today(){
  return new Date().toISOString().split("T")[0];
}

window.joinQueue = async function(){

  const phone = document.getElementById("phone").value;
  const people = parseInt(document.getElementById("people").value);
  const baby = parseInt(document.getElementById("baby").value);

  if(!phone || !people){
    alert("è¯·å¡«å†™å®Œæ•´èµ„æ–™");
    return;
  }

  await addDoc(collection(db,"queues"),{
    phone,
    people,
    babyChair: baby || 0,
    status:"waiting",
    tableNumber:"",
    date:today(),
    timestamp:Date.now()
  });

  document.getElementById("result").innerHTML =
    "æäº¤æˆåŠŸï¼Œè¯·ç­‰å¾…é€šçŸ¥ã€‚";
}

// ğŸ”¥ å®æ—¶ç›‘å¬ç­‰å¾…äººæ•°
onSnapshot(collection(db,"queues"),(snapshot)=>{

  const waiting = snapshot.docs.filter(d=>
    d.data().date===today() &&
    d.data().status==="waiting"
  );

  document.getElementById("waitingCount").innerHTML =
    "å½“å‰ç­‰å¾…äººæ•°: " + waiting.length;

});
</script>

</head>

<body>

<h2>ğŸœ æ’é˜Ÿç³»ç»Ÿ</h2>

ç”µè¯ (+60):<br>
<input id="phone"><br><br>

äººæ•°:<br>
<input type="number" id="people"><br><br>

å®å®æ¤…:<br>
<input type="number" id="baby"><br><br>

<button onclick="joinQueue()">æäº¤</button>

<h3 id="waitingCount"></h3>

<div id="result"></div>

</body>
</html>
