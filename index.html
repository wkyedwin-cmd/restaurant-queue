<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Queue System</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, where } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAhha-pRzGBXHfSO3PdZ0UmLgGtxfLWcPQ",
  authDomain: "yunnans-1u.firebaseapp.com",
  projectId: "yunnans-1u",
  storageBucket: "yunnans-1u.firebasestorage.app",
  messagingSenderId: "490439485047",
  appId: "1:490439485047:web:42d5ca722ade09c6b88872"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

function today(){
  return new Date().toISOString().split("T")[0];
}

window.joinQueue = async function(){

  const phone = document.getElementById("phone").value;
  const adults = parseInt(document.getElementById("adults").value);
  const babyChairs = parseInt(document.getElementById("babyChairs").value) || 0;
  const seatPreference = document.querySelector('input[name="seat"]:checked');

  if(!phone || !adults || !seatPreference){
    alert("è¯·å¡«å†™å®Œæ•´èµ„æ–™");
    return;
  }

  const seat = seatPreference.value;

  // è®¡ç®—ä»Šå¤©æ’å·æ•°é‡
  const q = query(collection(db,"queues"), where("date","==",today()));
  const snapshot = await getDocs(q);

  const queueNumber = "Q" + String(snapshot.size+1).padStart(3,'0');

  await addDoc(collection(db,"queues"),{
    queueNumber,
    phone,
    adults,
    babyChairs,
    totalPeople: adults + babyChairs,
    seatPreference: seat,
    status:"waiting",
    date:today(),
    timestamp:Date.now()
  });

  document.getElementById("result").innerHTML =
    `<h2>æ‚¨çš„å·ç : ${queueNumber}</h2>
     <p>æˆäºº: ${adults} äºº</p>
     <p>å®å®æ¤…: ${babyChairs} å¼ </p>
     <p>åº§ä½åå¥½: ${seat}</p>
     <p>è¯·ç­‰å¾…å·¥ä½œäººå‘˜é€šçŸ¥</p>`;
}
</script>

</head>

<body>

<h2>ğŸœ æ’é˜Ÿç³»ç»Ÿ</h2>

ç”µè¯ (+60):<br>
<input id="phone"><br><br>

ğŸ‘¨ æˆäººäººæ•° Adults:<br>
<input type="number" id="adults" min="1"><br><br>

ğŸ‘¶ å®å®æ¤…æ•°é‡ Baby Chairs:<br>
<input type="number" id="babyChairs" min="0" value="0"><br><br>

<h3>åº§ä½åå¥½ Seat Preference</h3>

<input type="radio" name="seat" value="å®¤å†… Indoor">
å®¤å†… Indoor<br>

<input type="radio" name="seat" value="å®¤å¤– Outdoor">
å®¤å¤– Outdoor<br>

<input type="radio" name="seat" value="éšæ„æœ€å¿« No Preference">
éšæ„æœ€å¿« No Preference<br><br>

<button onclick="joinQueue()">æäº¤ Submit</button>

<div id="result"></div>

</body>
</html>
