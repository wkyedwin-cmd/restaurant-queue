<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAhha-pRzGBXHfSO3PdZ0UmLgGtxfLWcPQ",
  authDomain: "yunnans-1u.firebaseapp.com",
  projectId: "yunnans-1u",
  storageBucket: "yunnans-1u.firebasestorage.app",
  messagingSenderId: "490439485047",
  appId: "1:490439485047:web:42d5ca722ade09c6b88872"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

function today(){
  return new Date().toISOString().split("T")[0];
}

function checkPassword(){
  const input = document.getElementById("password").value;

  if(input === "1234"){
    document.getElementById("login").style.display="none";
    document.getElementById("panel").style.display="block";
  }else{
    alert("å¯†ç é”™è¯¯");
  }
}

function openWhatsApp(phone){
  const clean = phone.replace("+","");
  window.open("https://wa.me/"+clean,"_blank");
}

function updateStatus(id,status){
  db.collection("queues").doc(id).update({
    status:status
  });
}

function assignTable(id){
  const tableNumber = prompt("è¯·è¾“å…¥æ¡Œå·:");
  if(!tableNumber){
    alert("å¿…é¡»è¾“å…¥æ¡Œå·");
    return;
  }

  db.collection("queues").doc(id).update({
    status:"seated",
    tableNumber: tableNumber
  });
}

function getColor(status){
  if(status==="waiting") return "#fff3cd";
  if(status==="seated") return "#e2d9f3";
  if(status==="completed") return "#d4edda";
  if(status==="cancelled") return "#f8d7da";
  return "white";
}

function renderData(list){

  const container = document.getElementById("results");
  container.innerHTML = "";

  list.forEach(item=>{

    container.innerHTML += `
    <div style="
      border:1px solid #ccc;
      margin:6px;
      padding:10px;
      background:${getColor(item.status)};
    ">

    ğŸ“… æ—¥æœŸ: ${item.date || "-"}<br>
    â° æ—¶é—´: ${item.time || "-"}<br>
    ğŸ†” æ’å·: <b>${item.queueNumber || "-"}</b><br>
    ğŸ‘¤ å§“å: ${item.name || "-"}<br>
    ğŸ“ ç”µè¯: ${item.phone || "-"}<br>
    ğŸ‘¨ æˆäºº: ${item.adults || 0}<br>
    ğŸ‘¶ å®å®æ¤…: ${item.babyChairs || 0}<br>
    ğŸª‘ åº§ä½: ${item.seatPreference || "-"}<br>
    ğŸ· æ¡Œå·: ${item.tableNumber || "-"}<br>
    ğŸ“Œ çŠ¶æ€: ${item.status || "-"}<br><br>

    <button onclick="openWhatsApp('${item.phone}')">
    ğŸ“± WhatsApp
    </button>

    ${item.status==="waiting" ?
    `<button onclick="assignTable('${item.id}')">
    ç¡®è®¤åˆ°åº—+åˆ†æ¡Œ
    </button>` : ""}

    ${item.status==="seated" ?
    `<button onclick="updateStatus('${item.id}','completed')">
    å…¥åº§å®Œæˆ
    </button>` : ""}

    <button onclick="updateStatus('${item.id}','cancelled')">
    å–æ¶ˆ
    </button>

    </div>
    `;
  });
}

db.collection("queues")
  .where("date","==",today())
  .orderBy("timestamp","asc")
  .onSnapshot(snapshot=>{

    const data = [];

    snapshot.forEach(doc=>{
      data.push({...doc.data(),id:doc.id});
    });

    renderData(data);

  });
</script>
</head>

<body>

<div id="login">
  <h2>Admin Login</h2>
  <input type="password" id="password">
  <button onclick="checkPassword()">Login</button>
</div>

<div id="panel" style="display:none;">

<h2>åå°ç®¡ç†ç³»ç»Ÿ</h2>

<div id="results"></div>

</div>

</body>
</html>
