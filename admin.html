<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, onSnapshot, updateDoc, doc } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAhha-pRzGBXHfSO3PdZ0UmLgGtxfLWcPQ",
  authDomain: "yunnans-1u.firebaseapp.com",
  projectId: "yunnans-1u",
  storageBucket: "yunnans-1u.firebasestorage.app",
  messagingSenderId: "490439485047",
  appId: "1:490439485047:web:42d5ca722ade09c6b88872"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

function today(){
  return new Date().toISOString().split("T")[0];
}

// ğŸ” ç™»å½•å¯†ç 
window.checkPassword = function(){
  const input = document.getElementById("password").value;
  const correctPassword = "1234";

  if(input === correctPassword){
    document.getElementById("login").style.display="none";
    document.getElementById("panel").style.display="block";
  }else{
    alert("å¯†ç é”™è¯¯ Wrong Password");
  }
}

onSnapshot(collection(db,"queues"),(snapshot)=>{

  let total = 0;
  let indoor = 0;
  let outdoor = 0;
  let noPref = 0;
  let smallGroup = 0;
  let bigGroup = 0;

  let waitingHTML = "<h3>ğŸŸ¡ Waiting</h3>";
  let completedHTML = "<h3>ğŸŸ¢ Completed</h3>";
  let cancelledHTML = "<h3>ğŸ”´ Cancelled</h3>";

  snapshot.forEach((d)=>{
    const data = d.data();

    if(data.date === today()){

      total++;

      if(data.seatPreference?.includes("å®¤å†…")) indoor++;
      if(data.seatPreference?.includes("å®¤å¤–")) outdoor++;
      if(data.seatPreference?.includes("éšæ„")) noPref++;

      if(data.adults <=4) smallGroup++;
      if(data.adults >=5) bigGroup++;

      const block = `
      <div style="border:1px solid #ccc;margin:5px;padding:8px;">
      <b>${data.queueNumber}</b><br>
      ç”µè¯: ${data.phone}<br>
      æˆäºº: ${data.adults} | å®å®æ¤…: ${data.babyChairs}<br>
      åº§ä½: ${data.seatPreference}<br><br>

      <button onclick="complete('${d.id}')">å®Œæˆ</button>
      <button onclick="cancel('${d.id}')">å–æ¶ˆ</button>
      <a target="_blank" href="https://wa.me/${data.phone.replace('+','')}">
      WhatsApp</a>
      </div>
      `;

      if(data.status === "waiting") waitingHTML += block;
      if(data.status === "completed") completedHTML += block;
      if(data.status === "cancelled") cancelledHTML += block;
    }
  });

  document.getElementById("stats").innerHTML = `
  ğŸ“Š ä»Šæ—¥æ•°æ®ç»Ÿè®¡<br><br>
  æ€»æ’é˜Ÿ: ${total} ç»„<br>
  å®¤å†…: ${indoor}<br>
  å®¤å¤–: ${outdoor}<br>
  éšæ„æœ€å¿«: ${noPref}<br><br>
  1â€“4äºº: ${smallGroup}<br>
  5äººä»¥ä¸Š: ${bigGroup}
  `;

  document.getElementById("waiting").innerHTML = waitingHTML;
  document.getElementById("completed").innerHTML = completedHTML;
  document.getElementById("cancelled").innerHTML = cancelledHTML;

});

window.complete = async function(id){
  await updateDoc(doc(db,"queues",id),{status:"completed"});
}

window.cancel = async function(id){
  await updateDoc(doc(db,"queues",id),{status:"cancelled"});
}
</script>
</head>

<body>

<div id="login">
  <h2>Admin Login</h2>
  <input type="password" id="password" placeholder="Enter Pas
