<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin</title>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, onSnapshot, updateDoc, doc } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAhha-pRzGBXHfSO3PdZ0UmLgGtxfLWcPQ",
  authDomain: "yunnans-1u.firebaseapp.com",
  projectId: "yunnans-1u",
  storageBucket: "yunnans-1u.firebasestorage.app",
  messagingSenderId: "490439485047",
  appId: "1:490439485047:web:42d5ca722ade09c6b88872"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

function today(){
  return new Date().toISOString().split("T")[0];
}

onSnapshot(collection(db,"queues"),(snapshot)=>{
  let html="<h2>后台管理</h2>";
  snapshot.forEach((d)=>{
    const data=d.data();
    if(data.date===today() && data.status==="waiting"){
      html+=`
      <div style="border:1px solid #ccc;margin:5px;padding:8px;">
      ${data.queueNumber} | ${data.phone} | ${data.people}人 | Baby:${data.babyChair}
      <br>
      <button onclick="complete('${d.id}')">完成</button>
      <button onclick="cancel('${d.id}')">取消</button>
      <a target="_blank" href="https://wa.me/${data.phone.replace('+','')}">
      WhatsApp</a>
      </div>
      `;
    }
  });
  document.getElementById("list").innerHTML=html;
});

window.complete=async function(id){
  await updateDoc(doc(db,"queues",id),{status:"completed"});
}

window.cancel=async function(id){
  await updateDoc(doc(db,"queues",id),{status:"cancelled"});
}
</script>
</head>
<body>
<div id="list"></div>
</body>
</html>
