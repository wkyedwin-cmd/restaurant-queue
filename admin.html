<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>åå°ç®¡ç†ç³»ç»Ÿ</title>
</head>
<body>

<h2>åå°ç®¡ç†ç³»ç»Ÿ</h2>

<input type="password" id="password" placeholder="Enter Password">
<button onclick="login()">Login</button>

<div id="adminPanel" style="display:none;">
<br>
<input type="text" id="search" placeholder="Search name / phone / queue number">

<h3>ğŸŸ¢ Waiting / Confirmed</h3>
<div id="activeList"></div>

<hr>

<h3>ğŸ”´ Cancelled / Completed</h3>
<div id="doneList"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  collection,
  onSnapshot,
  updateDoc,
  doc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "ä½ çš„APIKEY",
  authDomain: "ä½ çš„AUTHDOMAIN",
  projectId: "ä½ çš„PROJECTID",
  storageBucket: "ä½ çš„STORAGE",
  messagingSenderId: "ä½ çš„MSGID",
  appId: "ä½ çš„APPID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.login = function() {
  const pwd = document.getElementById("password").value;
  if (pwd === "1234") {
    document.getElementById("adminPanel").style.display = "block";
  } else {
    alert("Wrong password");
  }
}

const activeList = document.getElementById("activeList");
const doneList = document.getElementById("doneList");
const searchInput = document.getElementById("search");

onSnapshot(collection(db, "queues"), (snapshot) => {
  activeList.innerHTML = "";
  doneList.innerHTML = "";

  const data = [];

  snapshot.forEach(docSnap => {
    data.push({ id: docSnap.id, ...docSnap.data() });
  });

  data.sort((a,b) => {
    if (a.date === b.date) {
      return a.time.localeCompare(b.time);
    }
    return a.date.localeCompare(b.date);
  });

  const keyword = searchInput.value?.toLowerCase() || "";

  data.forEach(item => {
    if (
      item.name?.toLowerCase().includes(keyword) ||
      item.phone?.includes(keyword) ||
      item.queueNumber?.toLowerCase().includes(keyword)
    ) {

      const div = document.createElement("div");
      div.innerHTML = `
      <b>${item.date}</b> | ${item.time} |
      ${item.queueNumber} |
      ${item.name} |
      ${item.phone} |
      æˆäºº:${item.adults} å®å®æ¤…:${item.babyChairs} |
      ${item.seating} |
      çŠ¶æ€:${item.status}
      <br>
      <button onclick="updateStatus('${item.id}','confirmed')">Confirmed</button>
      <button onclick="updateStatus('${item.id}','completed')">Completed</button>
      <button onclick="updateStatus('${item.id}','cancelled')">Cancelled</button>
      <hr>
      `;

      if (item.status === "waiting" || item.status === "confirmed") {
        activeList.appendChild(div);
      } else {
        doneList.appendChild(div);
      }
    }
  });
});

window.updateStatus = async function(id,status) {
  await updateDoc(doc(db,"queues",id), { status });
}

searchInput.addEventListener("input", () => {
  location.reload();
});
</script>

</body>
</html>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAhha-pRzGBXHfSO3PdZ0UmLgGtxfLWcPQ",
  authDomain: "yunnans-1u.firebaseapp.com",
  projectId: "yunnans-1u",
  storageBucket: "yunnans-1u.firebasestorage.app",
  messagingSenderId: "490439485047",
  appId: "1:490439485047:web:42d5ca722ade09c6b88872"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let allData = [];

function today(){
  return new Date().toISOString().split("T")[0];
}

function checkPassword(){
  const input = document.getElementById("password").value;
  if(input === "1234"){
    document.getElementById("login").style.display="none";
    document.getElementById("panel").style.display="block";
    loadData();
  }else{
    alert("å¯†ç é”™è¯¯");
  }
}

function openWhatsApp(phone){
  if(!phone) return;
  const clean = phone.replace("+","");
  window.open("https://wa.me/"+clean,"_blank");
}

function updateStatus(id,status){
  db.collection("queues").doc(id).update({status:status});
}

function assignTable(id){
  const tableNumber = prompt("è¯·è¾“å…¥æ¡Œå·:");
  if(!tableNumber) return;

  db.collection("queues").doc(id).update({
    status:"confirmed",
    tableNumber: tableNumber
  });
}

function renderList(list, container){
  container.innerHTML = "";

  list.forEach(item=>{
    container.innerHTML += `
    <div style="border:1px solid #ccc;margin:6px;padding:10px;">

    ğŸ“… æ—¥æœŸ: ${item.date || "-"}<br>
    â° æ—¶é—´: ${item.time || "-"}<br>
    ğŸ†” æ’å·: <b>${item.queueNumber || "-"}</b><br>
    ğŸ‘¤ å§“å: ${item.name || "-"}<br>
    ğŸ“ ç”µè¯: ${item.phone || "-"}<br>
    ğŸ‘¨ æˆäºº: ${item.adults || 0}<br>
    ğŸ‘¶ å®å®æ¤…: ${item.babyChairs || 0}<br>
    ğŸ· æ¡Œå·: ${item.tableNumber || "-"}<br>
    ğŸ“Œ çŠ¶æ€: ${item.status || "-"}<br><br>

    <button onclick="openWhatsApp('${item.phone}')">WhatsApp</button>

    ${item.status==="waiting" ?
      `<button onclick="assignTable('${item.id}')">
        ç¡®è®¤åˆ°åº—+åˆ†æ¡Œ
      </button>` : ""}

    ${item.status==="confirmed" ?
      `<button onclick="updateStatus('${item.id}','completed')">
        å…¥åº§å®Œæˆ
      </button>` : ""}

    <button onclick="updateStatus('${item.id}','cancelled')">
      å–æ¶ˆ
    </button>

    </div>
    `;
  });
}

function applyFilter(){

  const keyword = document.getElementById("search").value.toLowerCase();

  let active = [];
  let finished = [];

  allData.forEach(data=>{

    const match =
      (data.name || "").toLowerCase().includes(keyword) ||
      (data.phone || "").includes(keyword) ||
      String(data.queueNumber || "").includes(keyword);

    if(match){

      if(data.status==="waiting" || data.status==="confirmed"){
        active.push(data);
      }else{
        finished.push(data);
      }

    }
  });

  active.sort((a,b)=>(a.timestamp||0)-(b.timestamp||0));
  finished.sort((a,b)=>(a.timestamp||0)-(b.timestamp||0));

  renderList(active, document.getElementById("activeList"));
  renderList(finished, document.getElementById("finishedList"));
}

function loadData(){

  db.collection("queues")
  .where("date","==",today())
  .onSnapshot(snapshot=>{

    allData = [];

    snapshot.forEach(doc=>{
      allData.push({...doc.data(), id: doc.id});
    });

    applyFilter();
  });
}
</script>
</head>

<body>

<div id="login">
  <h2>Admin Login</h2>
  <input type="password" id="password">
  <button onclick="checkPassword()">Login</button>
</div>

<div id="panel" style="display:none;">

<h2>åå°ç®¡ç†ç³»ç»Ÿ</h2>

<input 
  type="text" 
  id="search" 
  placeholder="ğŸ” æœç´¢åå­— / ç”µè¯ / æ’å·"
  oninput="applyFilter()"
  style="width:300px;padding:6px;margin-bottom:15px;"
>

<h3>å¾…å¤„ç†ï¼ˆWaiting + Confirmedï¼‰</h3>
<div id="activeList"></div>

<hr style="margin:30px 0; border:2px solid #000;">

<h3>å·²å¤„ç†ï¼ˆCancelled + Completedï¼‰</h3>
<div id="finishedList"></div>

</div>

</body>
</html>

